<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://qconsulting.ca/fo3/ModConfig5.0.xsd">

    <moduleName>Heart of Magic - Spell Learning &amp; Progression</moduleName>

    <!-- ================================================================== -->
    <!-- REQUIRED FILES — always installed                                   -->
    <!-- ================================================================== -->
    <requiredInstallFiles>
        <folder source="SKSE"     destination="SKSE"     priority="0"/>
        <folder source="PrismaUI" destination="PrismaUI" priority="0"/>
        <folder source="Scripts"  destination="Scripts"  priority="0"/>
    </requiredInstallFiles>

    <!-- ================================================================== -->
    <!-- INSTALL STEPS — optional user choices                               -->
    <!-- ================================================================== -->
    <installSteps order="Explicit">
        <installStep name="Compatibility Patches">
            <optionalFileGroups order="Explicit">
                <group name="ISL / DEST / Sit Down and Read / GTS Traits" type="SelectAny">
                    <plugins order="Explicit">
                        <plugin name="Merged ISL Compatibility Patch">
                            <description>
Merged compatibility patch for ISL-DESTified, Sit Down and Read, and GTS Trait Rebalanced.

Replaces DontEatSpellTomes.dll with an inert shim and installs a merged study script that preserves ALL features from every mod:

- Heart of Magic: Spell XP from studying, progression integration
- Sit Down and Read: GPMA/OAR animations, ImprovedCameraSE and TrueDirectionalMovement support, 1st-person study
- GTS Trait Rebalanced: Bookworm trait study speed bonus
- Bug fix: Save-load re-registration (prevents spell tome hook from silently breaking)

All features degrade gracefully — if a mod is not installed, its features are simply inactive.

IMPORTANT: Load Heart of Magic AFTER ISL/DEST/GTS/SDR so the merged scripts take priority.

Auto-selected if ISL or DEST is detected. If you don't use ISL, leave this unchecked.
                            </description>
                            <conditionFlags>
                                <flag name="ISLDetected">On</flag>
                            </conditionFlags>
                            <files>
                                <folder source="optional\ISLPatch\SKSE" destination="SKSE" priority="1"/>
                                <folder source="optional\ISLPatch\Scripts" destination="Scripts" priority="1"/>
                            </files>
                            <typeDescriptor>
                                <dependencyType>
                                    <defaultType name="Optional"/>
                                    <patterns>
                                        <pattern>
                                            <dependencies operator="Or">
                                                <fileDependency file="DEST_ISL.esp" state="Active"/>
                                                <fileDependency file="DontEatSpellTomes.esp" state="Active"/>
                                                <fileDependency file="SKSE\Plugins\DontEatSpellTomes.dll" state="Active"/>
                                            </dependencies>
                                            <type name="Recommended"/>
                                        </pattern>
                                    </patterns>
                                </dependencyType>
                            </typeDescriptor>
                        </plugin>
                    </plugins>
                </group>
            </optionalFileGroups>
        </installStep>
    </installSteps>

    <!-- ================================================================== -->
    <!-- CONDITIONAL — auto-install ISL compatibility patch                  -->
    <!-- ================================================================== -->
    <conditionalFileInstalls>
        <patterns>
            <pattern>
                <dependencies operator="Or">
                    <fileDependency file="DEST_ISL.esp"             state="Active"/>
                    <fileDependency file="DontEatSpellTomes.esp"    state="Active"/>
                    <fileDependency file="SKSE\Plugins\DontEatSpellTomes.dll" state="Active"/>
                </dependencies>
                <files>
                    <folder source="optional\ISLPatch\SKSE" destination="SKSE" priority="1"/>
                    <folder source="optional\ISLPatch\Scripts" destination="Scripts" priority="1"/>
                </files>
            </pattern>
        </patterns>
    </conditionalFileInstalls>

</config>
